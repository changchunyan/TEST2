<div class="view-frame">
    <div class="view-left">
        <div ng-include="'partials/common/common.indexLeft.html'"></div>
    </div>
    <div ng-show="isList" class="view-content user-love">
        <div>
            <div>
                <ul class="breadcrumb">
                    <li><a href="#/">首页</a> <span class="divider"></span></li>
                    <li><a href="#/fb-admin">前台业务</a> <span class="divider"></span></li>
                    <li><a ng-click="showListView()">领取意向客户</a> <span class="divider"></span></li>
                    <li class="active">意向客户列表</li>
                </ul>
            </div>
            <div class="mt-10">
                <div class="mt-student-m">
                    <ul class="f14 cf">
                        <li ng-if="showPermissions('LeadsAllot') || showPermissions('ReceiveLeadsAllot')">
                        	<a class="mt-gree" ng-click="showSpecialBatchAllotView()" style="padding-right: 15px">批量分配</a>
                        </li>
                        <li ng-if="showPermissions('LeadsAllot') || showPermissions('ReceiveLeadsAllot')">
                        	<a class="mt-gree" ng-click="showSpecialAllotView()">分配</a>
                        </li>
                    </ul>
                </div>
                <div class="br-gray mt-list">
                    <h2 class="pl-20 c3">领取意向客户
                    	<span class="vertical-align-bottom fr"><input type="checkbox" ng-click="quickSelectedException()">过滤异常客户</span>
						<span class="vertical-align-bottom fr"><input type="checkbox" ng-click="quickSelectGraduation()" checked="isSelectedGraduation">过滤高中毕业意向客户</span>
                    </h2>
                    <div class="overflow-x">
                        <table class="table table-bordered table-striped table-condensed mt-table1" st-pipe="getReceiveCrmLeadsStudentList" st-table="receiveCrmLeadsStudentList">
                            <thead>
	                            <tr class="br-gray-t">
	                                <th>姓名</th>
	                                <th>电话</th>
	                                <th>年级</th>
	                                <th>体验科目</th>
	                                <th>体验领取时间</th>
	                                <th>地址</th>
	                                <th>渠道来源</th>
	                                <th>来源详情</th>
	                                <th>客户状态</th>
	                                <th>记录</th>
	                                <th>所属校区</th>
	                                <th>创建时间</th>
	                                <th>创建人</th>
	                                <th>所属人</th>
	                                <th>推荐人</th>
	                                <th>操作</th>
	                            </tr>
	                            <tr>
	                                <th>
	                                    <input st-search="receiveCrmLeadsStudentFilter.name" placeholder="姓名查询" ng-model="receiveCrmLeadsStudentFilter.name" class="input-sm form-control" type="search"/>
	                                </th>
	                                <th>
	                                    <input st-search="receiveCrmLeadsStudentFilter.phone" placeholder="电话查询" ng-model="receiveCrmLeadsStudentFilter.phone" class="input-sm form-control" type="search"/>
	                                </th>
	                                <th>
	                                    <select st-search="receiveCrmLeadsStudentFilter.receiveGradeId" ng-model="receiveCrmLeadsStudentFilter.receiveGradeId"
	                                            name="receiveCrmLeadsStudentFilter.receiveGradeId" id="receiveCrmLeadsStudentFilter.receiveGradeId" class="input-sm form-control"
	                                            ng-options="option.id as option.name for option in gradeIds" type="search">
	                                        <option value="">-- 请选择 --</option>
	                                    </select>
	                                </th>
	                                <th>
	                                	<select st-search="receiveCrmLeadsStudentFilter.experienceSubject" ng-model="receiveCrmLeadsStudentFilter.experienceSubject"
	                                            name="receiveCrmLeadsStudentFilter.experienceSubject" id="receiveCrmLeadsStudentFilter.experienceSubject" class="input-sm form-control"
	                                            ng-options="option.id as option.name for option in subjectIds" type="search">
	                                        <option value="">-- 请选择 --</option>
	                                    </select>
	                                </th>
	                                <th>
	                                    <input ng-model="receiveCrmLeadsStudentFilter.experienceCreatedAt" st-search="receiveCrmLeadsStudentFilter.experienceCreatedAt" type="date" class="input-sm form-control" type="search"/>
	                                </th>
	                                <th>
	                                	<input st-search="receiveCrmLeadsStudentFilter.experienceAddress" placeholder="地址" ng-model="receiveCrmLeadsStudentFilter.experienceAddress" class="input-sm form-control" type="search"/>
	                                </th>
	                                <th>
	                                    <select st-search="receiveCrmLeadsStudentFilter.media_channel_id_1" ng-model="receiveCrmLeadsStudentFilter.media_channel_id_1"
	                                            name="receiveCrmLeadsStudentFilter.media_channel_id_1" id="receiveCrmLeadsStudentFilter.media_channel_id_1" class="input-sm form-control"
	                                            ng-options="option.id as option.name for option in mediaChannel1List" ng-change="mediaChannel1ChangeForFilter()" type="search">
	                                        <option value="">-- 请选择 --</option>
	                                    </select>
	                                </th>
	                                <th>
	                                    <select ng-model="receiveCrmLeadsStudentFilter.media_channel_id_2" st-search="receiveCrmLeadsStudentFilter.media_channel_id_2"
	                                            name="receiveCrmLeadsStudentFilter.media_channel_id_2" id="receiveCrmLeadsStudentFilter.media_channel_id_2" class="input-sm form-control"
	                                            ng-options="option.id as option.name for option in mediaChannel2ListForMyFilter" type="search">
	                                        <option value="">-- 请选择 --</option>
	                                    </select>
	                                </th>
	                                <th>
	                                    <select ng-model="receiveCrmLeadsStudentFilter.state_id_1" st-search="receiveCrmLeadsStudentFilter.state_id_1"
	                                            name="receiveCrmLeadsStudentFilter.state1_id_1" id="receiveCrmLeadsStudentFilter.state1_id_1" class="input-sm form-control"
	                                            ng-options="option.id as option.name for option in state1List" ng-change="state1ChangeForFilter()" type="search">
	                                        <option value="">-- 请选择 --</option>
	                                    </select>
	                                </th>
	                                <th></th>
	                                <th></th>
	                                <th>
	                                    <input ng-model="receiveCrmLeadsStudentFilter.create_at" st-search="receiveCrmLeadsStudentFilter.create_at" type="date" class="input-sm form-control" type="search"/>
	                                </th>
	                                <th colspan="2">
	                                    <input ng-model="receiveCrmLeadsStudentFilter.belong_user_name" st-search="myCrmLeadsStudentFilter.belong_user_name" placeholder="所属人查询" class="input-sm form-control" type="search"/>
	                                </th>
	                                <th colspan="2">
	                                    <input st-search="receiveCrmLeadsStudentFilter.inviter_name" placeholder="推荐人查询" ng-model="receiveCrmLeadsStudentFilter.inviter_name" class="input-sm form-control" type="search"/>
	                                </th>
	                            </tr>
                            </thead>
                            <tbody ng-show="!isSchoolLoading" ng-controller="callPhoneCtrl">
	                            <tr ng-repeat="row in receiveCrmLeadsStudentList">
	                                <td>{{row.name}}</td>
	                                <td><!--{{row.phone}}-->
	                                    <a ng-click="callNumber(row,true)">
	                                        <span ng-if="!ifLastCommunicated(row)" class="glyphicon glyphicon-tel" title="未拨打"></span>
	                                        <span ng-if="ifLastCommunicated(row)" class="glyphicon glyphicon-tel2" title="已拨打"></span>
	                                    </a>
	                                </td>
	                                <td>{{row.receiveGradeName}}</td>
	                                <td>{{row.experienceSubject}}</td>
	                                <td>{{row.experienceCreatedAt | date:'yyyy-MM-dd HH:mm:ss'}}</td>
	                                <td>{{row.experienceAddress}}</td>
	                                <td>{{row.channel1Name}}</td>
	                                <td>{{row.channel2Name}}</td>
	                                <td>{{row.state1Name}}</td>
	                                <td><a ng-click="showRecordModal(row)">查看</a></td>
	                                <td>{{row.belong_school_name}}</td>
	                                <td>{{row.create_at | date:'yyyy-MM-dd HH:mm:ss'}}</td>
	                                <td>{{row.create_by}}</td>
	                                <td>{{row.belong_user_name}}</td>
	                                <td>{{row.inviter_name}}</td>
	                                <td>
	                                    <a class="showUI" id="nw+{{$index}}"  ng-click="nw[$index]=true"><span class="glyphicon glyphicon-caozuo" title="操作"></span></a>
	                                    <bubble  ng-if="nw[$index]" for="nw+{{$index}}" align="bottom" close="nw[$index]=false" close-action="outerchick " ng-mouseleave="nw[$index]=false;"><!--ng-mouseleave="nw[$index]=false;"-->
	                                        <ul>
	                                            <li ng-if="showPermissions('LeadsView')">
	                                                <a ng-click="viewCrmLeadsStudent(row)">查看</a>
	                                            </li>
	                                            <li ng-if="showPermissions('LeadsEdit') && canEditAndDelete(row.belong_user_id)">
	                                                <a ng-click="editCrmLeadsStudent(row)">编辑</a>
	                                            </li>
	                                        </ul>
	                                    </bubble>
	                                </td>
	                            </tr>
                            </tbody>
                            <tbody ng-show="isSchoolLoading">
	                            <tr>
	                                <td colspan="20" class="text-center"><div class="loading-indicator"></div>
	                                </td>
	                            </tr>
                            </tbody>
                            <tfoot>
                            <tr>
                                <td class="text-center" st-pagination="" st-items-by-page="10" st-template="partials/util/pagination.custom.html" st-template="partials/util/pagination.custom.html" colspan="20">
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- update LeadsStudent view -->
    <div ng-show="isUpdate" class="view-content">
        <div>
            <div>
                <ul class="breadcrumb">
                    <li><a href="#/">首页</a> <span class="divider"></span></li>
                    <li><a href="#/fb-admin">前台业务</a> <span class="divider"></span></li>
                    <li><a ng-click="showListView()">领取意向客户</a> <span class="divider"></span></li>
                    <li class="active">意向客户更新</li>
                </ul>
            </div>
        </div>
        <div class="details-title">意向客户编辑</div>
        <div class="tabs-wrap height900">
            <form name="updateLeadsForm" role="form" class="form-horizontal showcase-form table-responsive" novalidate="">
                <div class="tab-panel">
                    <div class="row">
                        <div class="col-sm-4 form-group">
                            <label for="leadsName" class="col-sm-4 control-label">* 客户姓名</label>
                            <div class="col-sm-8">
                                <input type="text" name="leadsName" id="leadsName_for_update" ng-model="detailForUpdate.name" placeholder="1到20个字符" class="form-control" ng-maxlength="20" ng-minlength="2" required/>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="phone" class="col-sm-4 control-label">* 客户电话</label>
                            <div class="col-sm-8">
                                <input type="text" name="phone" id="phone_for_update" class="form-control" ng-model="detailForUpdate.phone" required ng-pattern="/^[0-9]*$/" ng-maxlength="11" ng-change="repeatFroCreate(detailForUpdate.phone)"/>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="age" class="col-sm-4 control-label">* 客户年龄</label>
                            <div class="col-sm-8">
                                <input type="number" name="age" id="age_for_update" class="form-control" ng-model="detailForUpdate.age" ng-maxlength="2"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 form-group">
                            <label for="mother_name" class="col-sm-4 control-label">* 母亲姓名</label>
                            <div class="col-sm-8">
                                <input type="text" name="mother_name" id="mother_name_for_update" class="form-control" ng-model="detailForUpdate.mother_name" ng-maxlength="20" ng-minlength="1"/>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="mother_phone" class="col-sm-4 control-label">* 母亲电话</label>
                            <div class="col-sm-8">
                                <input type="text" name="mother_phone" id="mother_phone_for_update" class="form-control" ng-model="detailForUpdate.mother_phone" ng-pattern="/^[0-9]*$/" ng-maxlength="11" ng-change="repeatFroCreate(detailForUpdate.mother_phone)"/>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group" >
                            <label for="gender_for_update" class="col-sm-4 control-label">* 客户性别</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.gender" name="gender" id="gender_for_update" class="form-control" ng-options="option.value as option.name for option in genders">
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 form-group">
                            <label for="father_name" class="col-sm-4 control-label">* 父亲姓名</label>
                            <div class="col-sm-8">
                                <input type="text" name="father_name" id="father_name_for_update" class="form-control" ng-model="detailForUpdate.father_name" ng-maxlength="20" ng-minlength="1"/>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="father_phone" class="col-sm-4 control-label">* 父亲电话</label>
                            <div class="col-sm-8">
                                <input type="text" name="father_phone" id="father_phone_for_update" class="form-control" ng-model="detailForUpdate.father_phone" ng-pattern="/^[0-9]*$/" ng-maxlength="11" ng-change="repeatFroCreate(detailForUpdate.father_phone)"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 form-group">
                            <label for="school_name" class="col-sm-4 control-label">* 公立学校</label>
                            <div class="col-sm-8">
                                <input type="text" name="school_name" id="school_name_for_update" class="form-control" ng-model="detailForUpdate.school_name" ng-maxlength="50"/>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="grade_id" class="col-sm-4 control-label">* 所在年级</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.grade_id" name="grade_id" id="grade_id_for_update" class="form-control" ng-options="option.id as option.name for option in gradeIds" required>
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="subject_id" class="col-sm-4 control-label">* 咨询科目</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.subject_id" name="subject_id" id="subject_id_for_update" class="form-control" ng-options="option.id as option.name for option in subjectIds">
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 form-group">
                            <label for="state_id_1" class="col-sm-4 control-label">* 客户状态</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.state_id_1" name="state_id_1" id="state_id_1_for_update" class="form-control"
                                        ng-options="option.id as option.name for option in state1List" ng-change="state1ChangeForUpdate()" required disabled="disabled">
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="detailForUpdate.followUpAt" class="col-sm-4 control-label">* 下次跟进时间</label>
                            <div class="col-sm-8">
                                <input type="text" datepicker onclick="WdatePicker({dateFmt:'yyyy-MM-dd H:mm:ss'})" name="detailForUpdate.followUpAt" class="form-control"
                                       ng-model="detailForUpdate.followUpAt" ng-value="{{ detailForUpdate.followUpAt  }}" onchange="" readonly/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 form-group">
                            <label for="media_channel_id_1" class="col-sm-4 control-label">* 渠道来源</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.media_channel_id_1" name="media_channel_id_1" id="media_channel_id_1_for_update" class="form-control"
                                        ng-options="option.id as option.name for option in mediaChannel1List" ng-change="mediaChannel1ChangeForUpdate()" disabled readonly="readonly" required>
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group" ng-if="detailForUpdate.media_channel_id_2">
                            <label for="media_channel_id_2" class="col-sm-4 control-label">* 渠道详情</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.media_channel_id_2" name="media_channel_id_2" id="media_channel_id_2_for_update" class="form-control"
                                        ng-options="option.id as option.name for option in mediaChannel2List" disabled readonly="readonly">
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 form-group">
                            <label for="detailForUpdate.purposeLevel" class="col-sm-4 control-label">* 意向程度</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.purposeLevel"
                                    name="detailForUpdate.purposeLevel" id="detailForUpdate.purposeLevel" class="form-control"
                                    ng-options="option.value as option.name for option in purposeLevel">
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 form-group">
                            <label for="province_code" class="col-sm-4 control-label">所属省</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.province_code" name="province_code" id="province_code_for_update" class="form-control"
                                        ng-options="option.provinceCode as option.provinceName for option in provinceList" ng-change="provinceChangeForUpdate()">
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="city_code" class="col-sm-4 control-label">所属市</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.city_code" name="city_code" id="city_code_for_update" class="form-control"
                                        ng-options="option.cityCode as option.cityName for option in cityList" ng-change="cityChangeForUpdate()">
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <label for="area_code" class="col-sm-4 control-label">所属区(县)</label>
                            <div class="col-sm-8">
                                <select ng-model="detailForUpdate.area_code" name="area_code" id="area_code_for_update" class="form-control"
                                        ng-options="option.areaCode as option.areaName for option in areaList">
                                    <option value="">-- 请选择 --</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 form-group">
                            <div class="col-sm-12 text-center">
                                <textarea ng-model="detailForUpdate.customer_requirement" name="customer_requirement" id="customer_requirement_for_update" placeholder="用户需求..." class="form-control width80" rows="3" ng-maxlength="500"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <input type="hidden" ng-model="detailForUpdate.crm_student_id"/>
                    <button class="btn btn-success" ng-disabled="updateLeadsForm.$invalid" ng-click="updateLeadsStudent()">保存</button>
                    <button class="btn btn-default" ng-click="showListView()">取消</button>
                </div>
            </form>
        </div>
    </div>

    <!--LeadsStudent Detail view-->
    <div ng-if="isDetail" class="view-content2">
        <div>
            <div>
                <ul class="breadcrumb">
                    <li><a href="#/">首页</a> <span class="divider"></span></li>
                    <li><a href="#/fb-admin">前台业务</a> <span class="divider"></span></li>
                    <li><a ng-click="showListView()">领取意向客户</a> <span class="divider"></span></li>
                    <li class="active">意向客户详情</li>
                </ul>
            </div>
        </div>
        <div class="details-title">意向客户详情
            <span style="color:#Fc990a" ng-if='isCalling'>-------通话中</span>
            <img ng-if='isCalling' src="img/icon/util/wen.png" class="icon-wen" style="width: 18px;height:18px;margin-left: 20px;" id="calling">
            <div class="leads-top-btn">
                <div class="operations-panel" >
                    <button class="btn btn-success" ng-click="showListView()">返回</button>
                </div>
            </div>
        </div>
        <div class="tabs-wrap">
            <table class="table table-bordered border-ccc">
                <tr>
                    <td class="info">姓名</td>
                    <td>{{detail.name}}
                        <a>
                            <span ng-if="detail.exception_status !=1 && detail.exception_status" class="glyphicon glyphicon-yichang2" title="异常"></span>
                        </a>
                    </td>
                    <td class="info">电话</td>
                    <td >{{detail.phone}}
                        <span ng-if="detail.phone && (detail.phone_status !=1 && detail.phone_status)" class="glyphicon glyphicon-yichang2" title="异常"></span>
                    </td>
                    <td class="info">咨询科目</td><td ng-bind="detail.subject_name"></td>
                </tr>
                <tr>
                    <td class="info">母亲姓名</td><td ng-bind="detail.mother_name"></td>
                    <td class="info">母亲电话</td>
                    <td >{{detail.mother_phone}}
                        <span ng-if="detail.mother_phone && (detail.mother_phone_status ==1 || !detail.mother_phone_status)" class="glyphicon glyphicon-yichang wyc" title="无异常"></span>
                        <span ng-if="detail.mother_phone && detail.mother_phone_status ==2" class="glyphicon glyphicon-yichang2" title="空号"></span>
                        <span ng-if="detail.mother_phone && detail.mother_phone_status ==3" class="glyphicon glyphicon-yichang2" title="错号"></span>
                        <span ng-if="detail.mother_phone && detail.mother_phone_status ==4" class="glyphicon glyphicon-yichang2" title="停机"></span>
                        <span ng-if="detail.mother_phone && detail.mother_phone_status ==5" class="glyphicon glyphicon-yichang2" title="被投诉"></span>
                    </td>
                    <td class="info">年级</td><td ng-bind="detail.grade_name"></td>
                </tr>
                <tr>
                    <td class="info">父亲姓名</td><td ng-bind="detail.father_name"></td>
                    <td class="info">父亲电话</td>
                    <td >{{detail.father_phone}}
                        <span ng-if="detail.father_phone && (detail.father_phone_status ==1 || !detail.father_phone_status)" class="glyphicon glyphicon-yichang wyc" title="无异常"></span>
                        <span ng-if="detail.father_phone && detail.father_phone_status ==2" class="glyphicon glyphicon-yichang2" title="空号"></span>
                        <span ng-if="detail.father_phone && detail.father_phone_status ==3" class="glyphicon glyphicon-yichang2" title="错号"></span>
                        <span ng-if="detail.father_phone && detail.father_phone_status ==4" class="glyphicon glyphicon-yichang2" title="停机"></span>
                        <span ng-if="detail.father_phone && detail.father_phone_status ==5" class="glyphicon glyphicon-yichang2" title="被投诉"></span>
                    </td>
                    <td class="info">...</td><td>...</td>
                </tr>
                <tr>
                    <td class="info">公立学校</td><td ng-bind="detail.school_name"></td>
                    <td class="info">性别</td><td ng-show="detail.gender == true">男</td><td ng-show="detail.gender == false">女</td><td ng-show="detail.gender == null"></td>
                    <td class="info">出生年月</td>
                    <td>{{detail.birthDate|date:'yyyy-MM-dd'}}</td>
                </tr>
                <tr>
                    <td class="info">所属省</td><td ng-bind="detail.province_name"></td>
                    <td class="info">所属市</td><td ng-bind="detail.city_name"></td>
                    <td class="info">所属区(县)</td><td ng-bind="detail.area_name"></td>
                </tr>
                <tr>
                    <td class="info">渠道来源</td><td ng-bind="detail.channel1Name"></td>
                    <td class="info">客户状态</td><td ng-bind="detail.state1Name"></td>
                    <td class="info">意向程度</td>
                        <td ng-if="detail.purposeLevel && detail.purposeLevel == 1">高</td>
                        <td ng-if="detail.purposeLevel && detail.purposeLevel == 2">一般</td>
                        <td ng-if="detail.purposeLevel && detail.purposeLevel == 3">暂无</td>
                        <td ng-if="!detail.purposeLevel || (detail.purposeLevel && detail.purposeLevel == 4)">未标记</td>
                </tr>
                <tr>
                    <td class="info">渠道详情</td><td ng-bind="detail.channel2Name"></td>
                    <td class="info">下次跟进时间</td><td ng-bind="detail.followUpAt | date:'yyyy-MM-dd HH:mm:ss'"></td>
                    <td class="info">创建时间</td><td ng-bind="detail.create_at | date:'yyyy-MM-dd HH:mm:ss'"></td>
                </tr>
                <tr>
                    <td class="info">创建人</td><td ng-bind="detail.create_by_name"></td>
                    <td class="info">所属人</td><td ng-bind="detail.belong_user_name"></td>
                    <td class="info">推荐人</td><td ng-bind="detail.inviter_name"></td>
                </tr>
                <tr>
                    <td class="info">客户需求</td><td colspan="5" ng-bind="detail.customer_requirement"></td>
                </tr>
            </table>
            <div class="yws-container text-align-center padding-20-0 border-1-eded mt-btn-r">
                <button type="button" ng-if="showPermissions('FreeListening')" class="btn btn-primary margin-left-50" ng-click="addCoursePlanInfo(detail,3)">试听</button>
                <button type="button" ng-if="showPermissions('LeadsEdit')  && canEditAndDelete(detail.belong_user_id)" class="btn btn-primary margin-left-50" ng-click="editCrmLeadsStudent(detail)">编辑</button>
                <button type="button" ng-if="showPermissions('LeadsOrderAdd')" class="btn btn-primary margin-left-50" ng-click="signContractOrder()" >录订单</button>
            </div>
        </div>
        <div ng-if="!isCallCenterMaster()">
            <div class="tabs-title" >记录管理</div>
            <tabs>
                <pane title="沟通记录">
                    <div class="table-responsive" >
                        <div class="table-title">沟通记录列表</div>
                        <table class="table table-bordered table-striped table-condensed" st-pipe="getCommunicationList" st-table="CrmLeadsStudentCommunicationList">
                            <thead>
                            <tr>
                                <th>沟通时间</th>
                                <th>沟通内容</th>
                                <th>沟通人</th>
                                <th>方式</th>
                                <th>状态</th>
                                <th>录音</th>
                                <th ng-if="false">创建人</th>
                                <th ng-if="false">创建时间</th>
                                <th>沟通操作</th>
                            </tr>
                            </thead>
                            <tbody ng-show="!isCommunicationLoading">
                            <tr ng-repeat="row in CrmLeadsStudentCommunicationList">
                                <td>{{ row.communicateTime | date:'yyyy-MM-dd' }}</td>
                                <td>{{row.communicateContent}}</td>
                                <td>{{row.username}}</td>
                                <td>{{row.calltype}}</td>
                                <td ng-if="row.callresult== 0">接通</td>
                                <td ng-if="row.callresult== 1">正忙</td>
                                <td ng-if="row.callresult== 2">无应答</td>
                                <td ng-if="row.callresult!= 1 && row.callresult!= 2 && row.callresult!= 0 && row.callresult!=-1">失败</td>
                                <td ng-if="row.callresult==-1"></td>
                                <td>
                                    <button ng-if="row.recording_path" class="btn btn-primary" ng-click="playAudio(row.recording_path)">播放</button>
                                </td>
                                <td ng-if="false">{{row.createBy}}</td>
                                <td ng-if="false">{{ row.createAt | date:'yyyy-MM-dd HH:mm:ss' }}</td>
                                <td>
                                    <a ng-click="editInvitationCommunication(row)"><span class="glyphicon glyphicon-pencil" title="编辑沟通"></span></a>&nbsp;
                                    <a ng-click="deleteInvitationCommunication(row)"><span class="glyphicon glyphicon-delete" title="删除沟通"></span></a>&nbsp;
                                </td>
                            </tr>
                            </tbody>
                            <tbody ng-show="isCommunicationLoading">
                            <tr>
                                <td colspan="7" class="text-center"><div class="loading-indicator"></div></td>
                            </tr>
                            </tbody>
                            <tfoot>
                            <tr>
                                <td class="text-center" st-pagination="" st-items-by-page="5" colspan="7" st-template="partials/util/pagination.custom.html" st-template="partials/util/pagination.custom.html">
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </pane>
                <pane title="邀约记录">
                    <div class="table-responsive" >
                        <div class="table-title">邀约记录列表</div>
                        <button class="btn btn-success table-top-button" ng-click="addInvitationDetail()">新增邀约</button>
                        <table class="table table-bordered table-striped table-condensed" st-pipe="getInvitationList" st-table="CrmLeadsStudentInvitationList">
                            <thead>
                            <tr>
                                <th>邀约时间</th>
                                <th>预到访时间</th>
                                <th>邀约内容</th>
                                <th>邀约人</th>
                                <th ng-if="false">创建人</th>
                                <th ng-if="false">创建时间</th>
                                <th>邀约操作</th>
                            </tr>
                            </thead>
                            <tbody ng-show="!isInvitationLoading">
                            <tr ng-repeat="row in CrmLeadsStudentInvitationList">
                                <td>{{ row.invitateTime | date:'yyyy-MM-dd HH:mm' }}</td>
                                <td>{{ row.receiveTime | date:'yyyy-MM-dd HH:mm' }}</td>
                                <td>{{row.invitationContent}}</td>
                                <td>{{row.username}}</td>
                                <td ng-if="false">{{row.createBy}}</td>
                                <td ng-if="false">{{ row.createAt | date:'yyyy-MM-dd HH:mm:ss' }}</td>
                                <td>
                                    <a ng-click="editInvitationDetail(row)"><span class="glyphicon glyphicon-pencil" title="编辑邀约"></span></a>&nbsp;
                                    <a ng-click="deleteInvitationDetail(row)"><span class="glyphicon glyphicon-delete" title="删除邀约"></span></a>&nbsp;
                                </td>
                            </tr>
                            </tbody>
                            <tbody ng-show="isInvitationLoading">
                            <tr>
                                <td colspan="7" class="text-center"><div class="loading-indicator"></div></td>
                            </tr>
                            </tbody>
                            <tfoot>
                            <tr>
                                <td class="text-center" st-pagination="" st-items-by-page="5" colspan="7" st-template="partials/util/pagination.custom.html" st-template="partials/util/pagination.custom.html">
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </pane>
            </tabs>
            <div class="tabs-title">消课管理</div>
            <tabs>
                <div class="table-responsive" >
                    <div class="table-title">排课消课管理</div>
                    <table class="table table-bordered table-striped table-condensed" st-pipe="callServer" st-table="displayed">
                        <thead>
                        <tr>
                            <th>学生姓名</th>
                            <th>消课状态</th>
                            <th>课程名称</th>
                            <th>科目</th>
                            <th colspan='2' >上课时间</th>
                            <th>上课课时</th>
                            <th>任课老师</th>
                            <th>不满意原因</th>
                            <th>操作</th>
                        </tr>
                        <tr>
                            <th><input st-search="student_name" placeholder="学生姓名" class="input-sm form-control" type="search"/></th>
                            <th><select st-search="is_past" placeholder="消课状态" class="input-sm form-control">
                                      <option value=""></option>
                                      <option value="0">未消课</option>
                                      <option value="1">已消课</option>
                                 </select>
                            </th>
                            <th><input st-search="coursename" placeholder="查询" class="input-sm form-control" type="search"/></th>
                            <th><input st-search="subject_name" placeholder="科目查询" class="input-sm form-control" type="search"/></th>
                            <th><input st-search="start_time" placeholder=""  class="input-sm form-control" type="search" datepicker onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" onchange="" readonly  style="margin-right:9%;"/></th>
                            <th><input st-search="end_time" placeholder=""  class="input-sm form-control" type="search" datepicker onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" onchange="" readonly /></th>
                            <th><input st-search="course_num" placeholder="课时" class="input-sm form-control" type="search"/></th>
                            <th><input st-search="teacher_name" placeholder="任课老师" class="input-sm form-control" type="search"/></th>
                            <th><select st-search="remark" placeholder="不满意原因" class="input-sm form-control">
                                  <option value=""></option>
                                  <option value="不满意">不满意</option>
                                  <option value="消课错误">消课错误</option>
                                  <option value="其他原因">其他原因</option>
                              </select>
                            </th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody ng-show="!isLoading">
                        <tr ng-repeat="row in displayed">
                            <td>{{ row.student_name }}</td>
                            <td ng-if="row.is_past==0">未消课</td>
                            <td ng-if="row.is_past==1">已消课</td>
                            <td>试听课程</td>
                            <td>{{row.subject_name}}</td>
                            <td colspan='2'>{{row.start_time | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                            <td>{{row.course_num}}</td>
                            <td>{{row.teacher_name}}</td>
                            <td>{{row.remark}}</td>
                            <td>
                                <a ng-if="row.is_past==0 && showPermissions('pastCoursePlan')" ng-click="yesconsume(row)"><span class="glyphicon glyphicon-shenhe" title="消课"></span></a>
								<a ng-if="row.is_past==0 && showPermissions('editCoursePlan')" ng-click="showEditCoursePlan(row)"><span class="glyphicon glyphicon-pencil" title="编辑"></span></a>
								<a ng-if="row.is_past==0 && showPermissions('deleteCoursePlan')" ng-click="removeCoursePlan(row)"><span class="glyphicon glyphicon-delete" title="删除排课"></span></a>
                            </td>
                        </tr>
                        </tbody>
                        <tbody ng-show="isLoading">
                        <tr>
                            <td colspan="10" class="text-center"><div class="loading-indicator"></div></td>
                        </tr>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td class="text-center" st-pagination="" st-items-by-page="10"  colspan="11" st-template="partials/util/pagination.custom.html" st-template="partials/util/pagination.custom.html">
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </tabs>
        </div>
    </div>
</div>